#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
==================================================
üåê SESSION GENERATOR v2.0
üîß Created by Rzayeffdi / Aƒüa
==================================================
"""

import asyncio
import os
import sys
import platform
import subprocess
import importlib
import time
from typing import Optional, Tuple
import getpass

# Import checks with enhanced error handling
try:
    from pyrogram import Client as PyroClient, __version__ as pyro_version
    from pyrogram.errors import (
        SessionPasswordNeeded, ApiIdInvalid, PhoneCodeInvalid, 
        PhoneCodeExpired, PhoneNumberInvalid, PhoneNumberUnoccupied,
        BadRequest
    )
except ImportError:
    pyro_available = False
else:
    pyro_available = True

try:
    from telethon import TelegramClient as TeleClient, __version__ as tele_version
    from telethon.sessions import StringSession as TeleString
    from telethon.errors import (
        ApiIdInvalidError, PhoneNumberInvalidError, 
        PhoneCodeInvalidError, PhoneCodeExpiredError,
        SessionPasswordNeededError, FloodWaitError
    )
except ImportError:
    telethon_available = False
else:
    telethon_available = True

# Color codes for terminal
class Colors:
    RED = '\033[91m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    BLUE = '\033[94m'
    MAGENTA = '\033[95m'
    CYAN = '\033[96m'
    WHITE = '\033[97m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'
    END = '\033[0m'

# System detection
class SystemDetector:
    @staticmethod
    def detect_environment():
        system = platform.system().lower()
        if 'termux' in os.environ.get('PREFIX', ''):
            return 'termux'
        elif system == 'linux':
            if 'kali' in platform.release().lower():
                return 'kali'
            elif 'ubuntu' in platform.version().lower():
                return 'ubuntu'
            else:
                return 'linux'
        elif system == 'windows':
            return 'windows'
        elif system == 'darwin':
            return 'macos'
        else:
            return 'unknown'
    
    @staticmethod
    def get_install_command(package_manager):
        commands = {
            'termux': 'pkg install',
            'ubuntu': 'sudo apt-get install',
            'kali': 'sudo apt-get install', 
            'linux': 'sudo apt-get install',
            'macos': 'brew install'
        }
        return commands.get(package_manager, 'pip install')

# Enhanced requirements management
class RequirementsManager:
    def __init__(self):
        self.environment = SystemDetector.detect_environment()
        self.required_packages = {
            'pyrogram': {
                'package': 'pyrogram',
                'min_version': '2.0.0',
                'install_cmd': 'pip install pyrogram tgcrypto'
            },
            'telethon': {
                'package': 'telethon', 
                'min_version': '1.24.0',
                'install_cmd': 'pip install telethon'
            }
        }
    
    def check_package(self, package_name):
        try:
            module = importlib.import_module(package_name)
            if package_name == 'pyrogram':
                current_version = pyro_version
            elif package_name == 'telethon':
                current_version = tele_version
            else:
                current_version = getattr(module, '__version__', '0.0.0')
            
            min_version = self.required_packages[package_name]['min_version']
            return self.compare_versions(current_version, min_version)
        except ImportError:
            return False, "0.0.0"
    
    def compare_versions(self, current, minimum):
        current_parts = list(map(int, current.split('.')))
        min_parts = list(map(int, minimum.split('.')))
        return current_parts >= min_parts, current
    
    def install_package(self, package_name):
        package_info = self.required_packages[package_name]
        print(f"\n{Colors.YELLOW}üì¶ {package_name} paketi y√ºkleniyor...{Colors.END}")
        
        try:
            if self.environment == 'termux':
                # Termux i√ßin √∂zel kurulum
                subprocess.run(f"pkg install python -y", shell=True, check=True)
            
            result = subprocess.run(
                f"{package_info['install_cmd']} --upgrade",
                shell=True,
                capture_output=True,
                text=True
            )
            
            if result.returncode == 0:
                print(f"{Colors.GREEN}‚úÖ {package_name} ba≈üarƒ±yla y√ºklendi!{Colors.END}")
                return True
            else:
                print(f"{Colors.RED}‚ùå {package_name} y√ºklenemedi: {result.stderr}{Colors.END}")
                return False
                
        except subprocess.CalledProcessError as e:
            print(f"{Colors.RED}‚ùå Kurulum hatasƒ±: {e}{Colors.END}")
            return False
    
    def check_and_install_all(self):
        print(f"\n{Colors.CYAN}üîç Gerekli paketler kontrol ediliyor...{Colors.END}")
        
        for package_name, info in self.required_packages.items():
            is_ok, version = self.check_package(package_name)
            
            if is_ok:
                print(f"{Colors.GREEN}‚úÖ {package_name} {version} - OK{Colors.END}")
            else:
                print(f"{Colors.YELLOW}‚ö†Ô∏è {package_name} bulunamadƒ± veya g√ºncel deƒüil ({version}){Colors.END}")
                choice = input(f"{Colors.CYAN}üì• {package_name} y√ºklemek istiyor musunuz? (e/h): {Colors.END}").lower()
                
                if choice in ['e', 'y', 'yes', 'evet']:
                    if self.install_package(package_name):
                        # Y√ºkleme sonrasƒ± tekrar kontrol
                        is_ok, new_version = self.check_package(package_name)
                        if is_ok:
                            print(f"{Colors.GREEN}‚úÖ {package_name} {new_version} ba≈üarƒ±yla y√ºklendi!{Colors.END}")
                        else:
                            print(f"{Colors.RED}‚ùå {package_name} hala y√ºkl√º deƒüil!{Colors.END}")
                            return False
                    else:
                        return False
                else:
                    print(f"{Colors.YELLOW}‚ö†Ô∏è {package_name} olmadan bazƒ± √∂zellikler √ßalƒ±≈ümayabilir.{Colors.END}")
        
        return True

# Enhanced session generator with better error handling
class PremiumSessionGenerator:
    def __init__(self):
        self.requirements = RequirementsManager()
        self.setup_directories()
    
    def setup_directories(self):
        """Gerekli dizinleri olu≈ütur"""
        directories = ['sessions', 'legacy_sessions', 'logs', 'backups']
        for directory in directories:
            os.makedirs(directory, exist_ok=True)
    
    def clear_screen(self):
        """Ekranƒ± temizle"""
        os.system('cls' if os.name == 'nt' else 'clear')
    
    def show_banner(self):
        """Premium banner g√∂ster"""
        banner = f"""
{Colors.CYAN}{Colors.BOLD}
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë  üåê UNIVERSAL PREMIUM SESSION GENERATOR v2.0                ‚ïë
‚ïë  üîß Created by: Rzayeffdi / Aƒüa                             ‚ïë
‚ïë  üöÄ Enhanced with Advanced Features                         ‚ïë
‚ïë                                                              ‚ïë
‚ïë  üìä System: {platform.system()} {platform.release()}{' '*(30-len(platform.system()+platform.release()))}‚ïë
‚ïë  üêç Python: {platform.python_version()}{' '*(38-len(platform.python_version()))}‚ïë
‚ïë  üåç Environment: {self.requirements.environment}{' '*(30-len(self.requirements.environment))}‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
{Colors.END}
        """
        print(banner)
    
    async def get_credentials(self, bot: bool = False) -> Tuple[str, str, Optional[str]]:
        """Kullanƒ±cƒ±dan kimlik bilgilerini al"""
        print(f"\n{Colors.CYAN}üîê Kimlik bilgilerini girin:{Colors.END}")
        
        while True:
            api_id = input(f"{Colors.BLUE}üîπ API_ID: {Colors.END}").strip()
            if api_id.isdigit() and len(api_id) >= 5:
                break
            print(f"{Colors.RED}‚ùå Ge√ßersiz API_ID! L√ºtfen sayƒ±lardan olu≈üan ge√ßerli bir API_ID girin.{Colors.END}")
        
        api_hash = input(f"{Colors.BLUE}üîπ API_HASH: {Colors.END}").strip()
        if not api_hash:
            print(f"{Colors.RED}‚ùå API_HASH bo≈ü olamaz!{Colors.END}")
            return await self.get_credentials(bot)
        
        bot_token = None
        if bot:
            bot_token = input(f"{Colors.BLUE}ü§ñ Bot Token: {Colors.END}").strip()
            if not bot_token:
                print(f"{Colors.RED}‚ùå Bot Token bo≈ü olamaz!{Colors.END}")
                return await self.get_credentials(bot)
        
        return api_id, api_hash, bot_token
    
    async def create_pyrogram_session(self, version: str, bot: bool):
        """Geli≈ümi≈ü Pyrogram session olu≈üturma"""
        print(f"\n{Colors.MAGENTA}üöÄ Pyrogram ({version}) {'BOT' if bot else 'USER'} Session Olu≈üturuluyor...{Colors.END}")
        
        try:
            api_id, api_hash, bot_token = await self.get_credentials(bot)
            session_name = f"pyrogram_{version}_{'bot' if bot else 'user'}_{int(time.time())}"
            
            # Client konfig√ºrasyonu
            client_config = {
                "api_id": int(api_id),
                "api_hash": api_hash,
                "workdir": "./sessions" if version == "new" else "./legacy_sessions",
                "in_memory": False
            }
            
            if bot:
                client_config["bot_token"] = bot_token
            else:
                client_config["session_name"] = session_name
            
            client = PyroClient(**client_config)
            
            # Baƒülantƒ± ve giri≈ü i≈ülemleri
            await client.start()
            
            if not bot:
                # User session i√ßin telefon doƒürulama
                await self.handle_user_authentication(client)
            
            # Session bilgilerini al
            me = await client.get_me()
            session_string = await client.export_session_string()
            
            # Sonu√ßlarƒ± g√∂ster
            await self.show_session_results(client, me, session_string, "Pyrogram", version, bot)
            
            # Session'ƒ± dosyaya kaydet
            await self.save_session_to_file(session_name, session_string, "pyrogram")
            
            await client.stop()
            
        except ApiIdInvalid:
            print(f"{Colors.RED}‚ùå Ge√ßersiz API_ID veya API_HASH!{Colors.END}")
        except PhoneNumberInvalid:
            print(f"{Colors.RED}‚ùå Ge√ßersiz telefon numarasƒ±!{Colors.END}")
        except Exception as e:
            print(f"{Colors.RED}‚ùå Beklenmeyen hata: {e}{Colors.END}")
    
    async def handle_user_authentication(self, client):
        """Kullanƒ±cƒ± doƒürulama i≈ülemleri"""
        phone_number = input(f"{Colors.BLUE}üìû Telefon Numarasƒ± (+994...): {Colors.END}").strip()
        
        sent_code = await client.send_code(phone_number)
        print(f"{Colors.YELLOW}üì≤ Doƒürulama kodu g√∂nderildi...{Colors.END}")
        
        while True:
            phone_code = input(f"{Colors.BLUE}üîê SMS ile gelen kodu girin: {Colors.END}").strip()
            
            try:
                await client.sign_in(phone_number, sent_code.phone_code_hash, phone_code)
                break
            except PhoneCodeInvalid:
                print(f"{Colors.RED}‚ùå Yanlƒ±≈ü kod! Tekrar deneyin.{Colors.END}")
            except PhoneCodeExpired:
                print(f"{Colors.RED}‚ùå Kodun s√ºresi dolmu≈ü! Yeniden kod istiyorum...{Colors.END}")
                sent_code = await client.resend_code(phone_number, sent_code.phone_code_hash)
            except SessionPasswordNeeded:
                print(f"{Colors.YELLOW}üîí 2FA etkin, ≈üifre gerekiyor...{Colors.END}")
                password = getpass.getpass(f"{Colors.BLUE}üîë 2FA ≈ûifresini girin: {Colors.END}")
                await client.check_password(password)
                break
    
    async def create_telethon_session(self, bot: bool):
        """Geli≈ümi≈ü Telethon session olu≈üturma"""
        print(f"\n{Colors.MAGENTA}‚ö° Telethon {'BOT' if bot else 'USER'} Session Olu≈üturuluyor...{Colors.END}")
        
        try:
            api_id, api_hash, bot_token = await self.get_credentials(bot)
            session_name = f"telethon_{'bot' if bot else 'user'}_{int(time.time())}"
            
            client = TeleClient(TeleString(), int(api_id), api_hash)
            
            if bot:
                await client.start(bot_token=bot_token)
            else:
                await client.start(phone=lambda: input(f"{Colors.BLUE}üìû Telefon Numarasƒ± (+994...): {Colors.END}").strip())
            
            me = await client.get_me()
            session_string = client.session.save()
            
            await self.show_session_results(client, me, session_string, "Telethon", "latest", bot)
            await self.save_session_to_file(session_name, session_string, "telethon")
            
            await client.disconnect()
            
        except Exception as e:
            print(f"{Colors.RED}‚ùå Hata: {e}{Colors.END}")
    
    async def show_session_results(self, client, me, session_string, lib_name, version, bot):
        """Session sonu√ßlarƒ±nƒ± g√∂ster"""
        print(f"\n{Colors.GREEN}{Colors.BOLD}‚úÖ {lib_name} Session Ba≈üarƒ±yla Olu≈üturuldu!{Colors.END}")
        print(f"{Colors.CYAN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ üë§ Ad: {me.first_name or me.username}{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ üÜî ID: {me.id}{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ üìõ Kullanƒ±cƒ± Adƒ±: @{me.username or 'Yok'}{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ ü§ñ T√ºr: {'Bot' if bot else 'User'}{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ üìö K√ºt√ºphane: {lib_name} {version}{Colors.END}")
        print(f"{Colors.CYAN}‚îÇ ‚è∞ Zaman: {time.strftime('%Y-%m-%d %H:%M:%S')}{Colors.END}")
        print(f"{Colors.CYAN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}")
        
        print(f"\n{Colors.YELLOW}üì¶ Session String:{Colors.END}")
        print(f"{Colors.WHITE}{session_string}{Colors.END}\n")
        
        # Saved Messages'a g√∂nder
        try:
            await client.send_message(
                "me",
                f"""**‚úÖ {lib_name} {'Bot' if bot else 'User'} Session Olu≈üturuldu!**

üë§ **Ad:** `{me.first_name or me.username}`
üÜî **ID:** `{me.id}`
üìõ **Kullanƒ±cƒ± Adƒ±:** `@{me.username or 'Yok'}`
ü§ñ **T√ºr:** `{'Bot' if bot else 'User'}`
üìö **Versiyon:** `{lib_name} {version}`
‚è∞ **Zaman:** `{time.strftime('%Y-%m-%d %H:%M:%S')}`

`{session_string}`"""
            )
            print(f"{Colors.GREEN}üíæ Session bilgileri Saved Messages'a g√∂nderildi!{Colors.END}")
        except Exception as e:
            print(f"{Colors.YELLOW}‚ö†Ô∏è Saved Messages'a g√∂nderilemedi: {e}{Colors.END}")
    
    async def save_session_to_file(self, session_name, session_string, lib_type):
        """Session'ƒ± dosyaya kaydet"""
        filename = f"sessions/{session_name}.txt"
        try:
            with open(filename, 'w', encoding='utf-8') as f:
                f.write(f"# {lib_type.upper()} SESSION STRING\n")
                f.write(f"# Generated: {time.strftime('%Y-%m-%d %H:%M:%S')}\n")
                f.write(f"# DO NOT SHARE THIS WITH ANYONE!\n\n")
                f.write(session_string)
            
            print(f"{Colors.GREEN}üíæ Session dosyaya kaydedildi: {filename}{Colors.END}")
        except Exception as e:
            print(f"{Colors.RED}‚ùå Dosyaya yazma hatasƒ±: {e}{Colors.END}")
    
    async def show_session_manager(self):
        """Session y√∂neticisi"""
        print(f"\n{Colors.CYAN}üìä Session Y√∂neticisi{Colors.END}")
        
        if os.path.exists('sessions'):
            sessions = [f for f in os.listdir('sessions') if f.endswith('.txt')]
            if sessions:
                print(f"{Colors.GREEN}üìÅ Mevcut Sessionlar:{Colors.END}")
                for i, session in enumerate(sessions, 1):
                    print(f"  {i}. {session}")
            else:
                print(f"{Colors.YELLOW}üìÅ Hen√ºz session dosyasƒ± bulunmamaktadƒ±r.{Colors.END}")
        else:
            print(f"{Colors.RED}üìÅ Sessions dizini bulunamadƒ±.{Colors.END}")
    
    async def system_info(self):
        """Sistem bilgilerini g√∂ster"""
        print(f"\n{Colors.CYAN}üñ•Ô∏è  Sistem Bilgileri{Colors.END}")
        print(f"{Colors.WHITE}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}")
        print(f"{Colors.WHITE}‚îÇ üñ•Ô∏è  ƒ∞≈ületim Sistemi: {platform.system()} {platform.release()}{Colors.END}")
        print(f"{Colors.WHITE}‚îÇ üêç Python Versiyonu: {platform.python_version()}{Colors.END}")
        print(f"{Colors.WHITE}‚îÇ üè† Ortam: {self.requirements.environment}{Colors.END}")
        print(f"{Colors.WHITE}‚îÇ üìÅ √áalƒ±≈üma Dizini: {os.getcwd()}{Colors.END}")
        
        if pyro_available:
            print(f"{Colors.WHITE}‚îÇ üî• Pyrogram Versiyonu: {pyro_version}{Colors.END}")
        if telethon_available:
            print(f"{Colors.WHITE}‚îÇ ‚ö° Telethon Versiyonu: {tele_version}{Colors.END}")
        
        print(f"{Colors.WHITE}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}")
    
    async def main_menu(self):
        """Ana men√º"""
        while True:
            self.clear_screen()
            self.show_banner()
            
            menu = f"""
{Colors.CYAN}üéØ ANA MEN√ú - Se√ßiminizi yapƒ±n:{Colors.END}

{Colors.GREEN}1Ô∏è‚É£  Pyrogram (Yeni Versiyon) User Session{Colors.END}
{Colors.GREEN}2Ô∏è‚É£  Pyrogram (Eski Versiyon) User Session{Colors.END}  
{Colors.GREEN}3Ô∏è‚É£  Pyrogram Bot Session{Colors.END}
{Colors.BLUE}4Ô∏è‚É£  Telethon User Session{Colors.END}
{Colors.BLUE}5Ô∏è‚É£  Telethon Bot Session{Colors.END}
{Colors.YELLOW}6Ô∏è‚É£  Session Y√∂neticisi{Colors.END}
{Colors.MAGENTA}7Ô∏è‚É£  Sistem Bilgileri{Colors.END}
{Colors.RED}0Ô∏è‚É£  √áƒ±kƒ±≈ü{Colors.END}

{Colors.CYAN}‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}
{Colors.CYAN}‚îÇ üí° ƒ∞pucu: Bot session i√ßin @BotFather'dan{Colors.END}
{Colors.CYAN}‚îÇ bot olu≈üturup API bilgilerini alƒ±n.{Colors.END}
{Colors.CYAN}‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{Colors.END}
            """
            print(menu)
            
            choice = input(f"{Colors.BOLD}üî∏ Se√ßiminiz (0-7): {Colors.END}").strip()
            
            if choice == "1":
                if pyro_available:
                    await self.create_pyrogram_session("new", False)
                else:
                    print(f"{Colors.RED}‚ùå Pyrogram kurulu deƒüil!{Colors.END}")
            elif choice == "2":
                if pyro_available:
                    await self.create_pyrogram_session("old", False)
                else:
                    print(f"{Colors.RED}‚ùå Pyrogram kurulu deƒüil!{Colors.END}")
            elif choice == "3":
                if pyro_available:
                    await self.create_pyrogram_session("new", True)
                else:
                    print(f"{Colors.RED}‚ùå Pyrogram kurulu deƒüil!{Colors.END}")
            elif choice == "4":
                if telethon_available:
                    await self.create_telethon_session(False)
                else:
                    print(f"{Colors.RED}‚ùå Telethon kurulu deƒüil!{Colors.END}")
            elif choice == "5":
                if telethon_available:
                    await self.create_telethon_session(True)
                else:
                    print(f"{Colors.RED}‚ùå Telethon kurulu deƒüil!{Colors.END}")
            elif choice == "6":
                await self.show_session_manager()
            elif choice == "7":
                await self.system_info()
            elif choice == "0":
                print(f"\n{Colors.GREEN}üëã G√∂r√º≈ümek √ºzere!{Colors.END}")
                break
            else:
                print(f"{Colors.RED}‚ùå Ge√ßersiz se√ßim!{Colors.END}")
            
            if choice != "0":
                input(f"\n{Colors.CYAN}‚èé Devam etmek i√ßin Enter'a basƒ±n...{Colors.END}")

async def main():
    """Ana fonksiyon"""
    generator = PremiumSessionGenerator()
    
    # Gereksinimleri kontrol et
    if not generator.requirements.check_and_install_all():
        print(f"{Colors.RED}‚ùå Gerekli paketler y√ºklenemedi!{Colors.END}")
        return
    
    # Ana men√ºy√º ba≈ülat
    try:
        await generator.main_menu()
    except KeyboardInterrupt:
        print(f"\n\n{Colors.YELLOW}‚ö†Ô∏è Program kullanƒ±cƒ± tarafƒ±ndan durduruldu.{Colors.END}")
    except Exception as e:
        print(f"\n\n{Colors.RED}‚ùå Beklenmeyen hata: {e}{Colors.END}")

if __name__ == "__main__":
    # Python versiyon kontrol√º
    if sys.version_info < (3, 7):
        print("‚ùå Python 3.7 veya √ºst√º gereklidir!")
        sys.exit(1)
    
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print(f"\n{Colors.YELLOW}üëã Program sonlandƒ±rƒ±ldƒ±.{Colors.END}")
